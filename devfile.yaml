schemaVersion: 2.1.0
metadata:
  name: nodejs-web-app
attributes:
      controller.devfile.io/storage-type: ephemeral  
components:
  - name: tools
    container:
      image: quay.io/devfile/universal-developer-image:ubi8-0e189d9
      endpoints:
        - exposure: public
          name: nodejs
          protocol: http
          targetPort: 3000
      memoryLimit: 1G
      mountSources: true
    attributes:
      controller.devfile.io/merge-contribution: true

  - name: ubi-minimal
    container:
      image: registry.access.redhat.com/ubi8/ubi-minimal
      command: ['tail']
      args: ['-f', '/dev/null']
      memoryLimit: 64M
      mountSources: true 

commands:
  - id: open-file
    exec:
      label: "Open Browser"
      component: tools
      commandLine: "${input:openSimpleBrowser}"
      
  - id: open-file-parameter
    exec:
      label: "Open File with parameter"
      component: tools
      commandLine: "${command:vscode.open}"
      
  - id: test-env-var
    exec:
      label: "Test $USER env var"
      component: tools
      commandLine: echo "Hello $USER !"
      env:
        - name: USER
          value: Roman
  - id: test-env-var-2
    exec:
      label: "Test ${USER} env var"
      component: tools
      commandLine: echo "Hello ${USER}!"
      env:
        - name: USER
          value: Roman
  - id: test-env-var-3
    exec:
      label: "Test mixed env vars with unknown var"
      component: tools
      commandLine: echo "cd $PROJECT_DIR && echo ${USER} && echo ${UNKNOWN_VAR} && echo $USER"
      env:
        - name: USER
          value: Roman
        - name: PROJECT_DIR
          value: /projects
  - id: test-env-var-4
    exec:
      label: "Test env var from container: ${KUBERNETES_SERVICE_HOST}"
      component: tools
      commandLine: echo "KUBERNETES_SERVICE_HOST ${KUBERNETES_SERVICE_HOST}"
  - id: test-env-var-5
    exec:
      label: "Test env var from container: $KUBERNETES_SERVICE_HOST"
      component: tools
      commandLine: echo "KUBERNETES_SERVICE_HOST $KUBERNETES_SERVICE_HOST"
  
